SHARED = ../../Shared
CFLAGS = -O2 -nostdlib -I.. -I$(SHARED)

OBJS = nodeclient.o
TARGET = libnodeclient.a

PREFIX = /usr/local/t800
BINDIR = $(PREFIX)/bin
LIBDIR = $(PREFIX)/lib
INCDIR = $(PREFIX)/include
CC = $(BINDIR)/t800-g++
LITDUMP = $(BINDIR)/litdump

all: $(TARGET) nodeclient.s

.cpp.s:
	$(CC) -S $(CFLAGS) -o $@ $<

.cpp.o:
	$(CC) -c $(CFLAGS) -o $@ $<

libnodeclient.a: $(OBJS)
	-rm -f $(TARGET)
	ar q $(TARGET) $(OBJS)

clean:
	-rm -f *.[aois] *~

install: all
	install -o root -g root -m644 libnodeclient.a $(LIBDIR)
	install -o root -g root -m644 nodeclient.h $(INCDIR)

# test to see whether the assembler generated by the compiler is reasonable
test: nodeclient.cpp
	$(CC) -S $(CFLAGS) -o nodeclient.s nodeclient.cpp

