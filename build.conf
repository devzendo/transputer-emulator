# Top level build commands, using https://github.com/devzendo/releaselite/
version: 0.0.2-SNAPSHOT

clean: rm -rf cmake-build-release; rm -rf cmake-build-debug; rm -rf target/classes

# To build for Raspberry Pi Pico:
# ./rl.py -D VARIANT="-D CROSS=PICO" compile
# If the prepare phase fails with Picotool, uncomment the line under 'Picotool
# problems?' in top-level CMakeLists.txt and retry. Once prepare is done,
# comment that line in again.
#
# To build desktop:
# ./rl.py -D VARIANT="" compile
#

# Working on the Pi Pico version, on macOS: run the above build for the pi pico, then edit cmake-build-release/CmakeCache.txt
# change /usr/bin/arm to /opt/local/bin/arm throughout
#  change /usr/bin/cmake to /opt/local/bin/cmake
#  change /usr/bin/gmake to /opt/local/bin/gmake
# in Makefile,
#  change /usr/bin/cmake to /opt/local/bin/cmake
# can now build in clion macos. can't build from docker command line.
prepare: mkdir -p target/classes; cp -r src/main/resources/* target/classes; sed -i 's/${project.version}/$VERSION/' target/classes/version.cpp; mkdir -p cmake-build-release; (cd cmake-build-release && cmake -G 'Unix Makefiles' $VARIANT ..)
unless: -e target/classes/version.cpp

compile: cmake --build cmake-build-release --target all

test: cd cmake-build-release; ctest --test-action Test --parallel 14 --verbose

