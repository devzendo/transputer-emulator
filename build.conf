# Top level build commands, using https://github.com/devzendo/releaselite/
version: 0.0.2-SNAPSHOT

clean: rm -rf cmake-build-release; rm -rf cmake-build-debug; rm -rf target/classes

# To build for Raspberry Pi Pico:
# ./rl.py -D VARIANT="-D CROSS=PICO" compile
# If the prepare phase fails with Picotool, uncomment the line under 'Picotool
# problems?' in top-level CMakeLists.txt and retry. Once prepare is done,
# comment that line in again.
#
# To build desktop:
# ./rl.py -D VARIANT="" compile
#

prepare: mkdir -p target/classes; cp -r src/main/resources/* target/classes; sed -i 's/${project.version}/$VERSION/' target/classes/version.cpp; mkdir -p cmake-build-release; (cd cmake-build-release && cmake -G 'Unix Makefiles' $VARIANT ..)
unless: -e target/classes/version.cpp

compile: cmake --build cmake-build-release --target all

test: cd cmake-build-release; ctest --test-action Test --parallel 14 --verbose

